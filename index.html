<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>{{ title }}</title>
    <meta name="description" content="{{ desc }}">
    <link rel="canonical" href="{{ base_url }}{{ lang_links[lang] }}">
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=106463725', 'ym');

    ym(106463725, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", referrer: document.referrer, url: location.href, accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/106463725" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
    <!-- SEO: Android & Mobile Optimization -->
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

   <link rel="manifest" href="/static/manifest.json">.

    <!-- HREFLANG -->
    <link rel="alternate" hreflang="en" href="{{ base_url }}{{ lang_links['en'] }}" />
    <link rel="alternate" hreflang="ru" href="{{ base_url }}{{ lang_links['ru'] }}" />
    <link rel="alternate" hreflang="es" href="{{ base_url }}{{ lang_links['es'] }}" />
    <link rel="alternate" hreflang="pt" href="{{ base_url }}{{ lang_links['pt'] }}" />
    <link rel="alternate" hreflang="x-default" href="{{ base_url }}{{ lang_links['en'] }}" />
<link rel="icon" type="image/x-icon" href="/favicon.ico">
    <!-- Google Search App Result Schema (JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "FileMaster Online",
      "operatingSystem": "Android, iOS, Windows, macOS",
      "applicationCategory": "File-Utility",
      "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" }
    }
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .tab-btn.active { border-bottom: 3px solid #2563eb; color: #2563eb; font-weight: 800; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .prose h2 { font-size: 1.4rem; font-weight: 900; margin: 1.5rem 0 1rem; color: #0f172a; }
        .prose p { margin-bottom: 1rem; color: #475569; }
    </style>
</head>
<body class="bg-slate-50 flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-white border-b sticky top-0 z-50 shadow-sm">
        <div class="max-w-5xl mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <a href="/{{ lang if lang != 'en' else '' }}" class="flex items-center space-x-2">
                    <div class="bg-blue-600 text-white p-1.5 rounded-lg shadow-md">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                    </div>
                    <span class="text-xl font-black text-slate-900">FileMaster</span>
                </a>
                
                <div class="flex space-x-3 text-xs font-bold uppercase tracking-widest">
                    <a href="{{ lang_links['en'] }}" class="{{ 'text-blue-600' if lang == 'en' else 'text-slate-400' }}">EN</a>
                    <a href="{{ lang_links['ru'] }}" class="{{ 'text-blue-600' if lang == 'ru' else 'text-slate-400' }}">RU</a>
                    <a href="{{ lang_links['es'] }}" class="{{ 'text-blue-600' if lang == 'es' else 'text-slate-400' }}">ES</a>
                    <a href="{{ lang_links['pt'] }}" class="{{ 'text-blue-600' if lang == 'pt' else 'text-slate-400' }}">PT</a>
                </div>
            </div>
            
            <nav class="flex overflow-x-auto no-scrollbar space-x-1 border-t">
                {% for tid, tname in nav_labels.items() %}
                <a href="{{ nav_urls[tid] }}" class="tab-btn px-4 py-3 text-xs uppercase font-bold whitespace-nowrap {{ 'active' if current_tool_id == tid else '' }}">
                    {{ tname }}
                </a>
                {% endfor %}
            </nav>
        </div>
    </header>

    <main class="flex-grow max-w-4xl mx-auto px-4 py-8 w-full">
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-5xl font-black text-slate-900 mb-4 tracking-tight leading-tight">{{ h1 }}</h1>
            <p class="text-slate-500">{{ desc }}</p>
        </div>

        <!-- Upload -->
        <div id="dropZone" class="bg-white border-2 border-dashed border-slate-300 rounded-3xl p-8 md:p-16 text-center shadow-inner cursor-pointer hover:border-blue-500 transition-all relative">
            <input type="file" id="fileInput" class="hidden">
            <div id="idleState">
                <div class="bg-blue-50 w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 text-blue-600">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                </div>
                <p class="font-black text-slate-800 uppercase text-sm tracking-widest">Click to upload</p>
            </div>
            <div id="loadingState" class="hidden py-4">
                <div class="animate-spin w-10 h-10 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-2"></div>
                <p class="text-xs font-bold text-blue-600 uppercase">Processing...</p>
            </div>
        </div>

        <!-- Results -->
        <div id="results" class="hidden mt-8 space-y-4">
            <div id="pdfBlock" class="hidden">
                <iframe id="pdfFrame" class="w-full h-96 border rounded-2xl mb-4 bg-white shadow-lg"></iframe>
                <a id="btnDownloadPdf" href="#" class="block w-full bg-blue-600 text-white text-center py-4 rounded-2xl font-black shadow-xl">DOWNLOAD PDF</a>
            </div>
            <div id="fileGrid" class="grid gap-3"></div>
            <div id="hexBlock" class="hidden bg-slate-900 p-6 rounded-2xl text-blue-400 font-mono text-xs overflow-x-auto">
                <pre id="hexView"></pre>
            </div>
            <button onclick="location.reload()" class="w-full text-slate-400 text-xs font-bold uppercase py-4">Reset / New File</button>
        </div>

        <section class="mt-16 border-t pt-10 prose prose-slate">
            {{ seo_text | safe }}
        </section>
    </main>

    <footer class="py-8 text-center text-[10px] text-slate-400 border-t uppercase tracking-widest font-bold">
        &copy; 2024 FileMaster Online â€¢ <a href="/sitemap.xml" class="text-blue-500">Sitemap</a>
    </footer>

    <script>
        const CUR_TOOL = "{{ current_tool_id }}";
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        dropZone.onclick = () => fileInput.click();
        fileInput.onchange = e => processFile(e.target.files[0]);
        dropZone.ondragover = e => { e.preventDefault(); dropZone.classList.add('bg-blue-50'); };
        dropZone.ondragleave = () => dropZone.classList.remove('bg-blue-50');
        dropZone.ondrop = e => { e.preventDefault(); processFile(e.dataTransfer.files[0]); };

        async function processFile(file) {
            if(!file) return;
            document.getElementById('idleState').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');

            try {
                if (file.name.toLowerCase().endsWith('.pages') && CUR_TOOL !== 'bin') {
                    const fd = new FormData(); fd.append('file', file);
                    const res = await fetch('/convert-pages', { method: 'POST', body: fd });
                    const data = await res.json();
                    document.getElementById('pdfBlock').classList.remove('hidden');
                    document.getElementById('pdfFrame').src = data.url;
                    document.getElementById('btnDownloadPdf').href = data.url;
                } else {
                    const buf = await file.arrayBuffer();
                    const u8 = new Uint8Array(buf);
                    
                    if(CUR_TOOL === 'bin' || CUR_TOOL === 'dat') {
                        document.getElementById('hexBlock').classList.remove('hidden');
                        document.getElementById('hexView').textContent = Array.from(u8.slice(0, 128))
                            .map(b => b.toString(16).padStart(2, '0').toUpperCase()).join(' ');
                    }
                    addCard(file.name, buf, 'ðŸ“„');
                }
                dropZone.classList.add('hidden');
                document.getElementById('results').classList.remove('hidden');
            } catch (e) { alert("Error processing file"); location.reload(); }
        }

        function addCard(name, buf, icon) {
            const blob = new Blob([buf]);
            const url = URL.createObjectURL(blob);
            const div = document.createElement('div');
            div.className = "bg-white p-5 rounded-2xl border shadow-sm flex items-center justify-between";
            div.innerHTML = `<div class="flex items-center space-x-3 overflow-hidden">
                <span class="text-2xl">${icon}</span>
                <div class="font-bold text-sm truncate pr-4">${name}</div>
            </div>
            <a href="${url}" download="${name}" class="bg-blue-600 text-white px-5 py-2 rounded-xl text-xs font-black">SAVE</a>`;
            document.getElementById('fileGrid').appendChild(div);
        }
    </script>
</body>
</html>


